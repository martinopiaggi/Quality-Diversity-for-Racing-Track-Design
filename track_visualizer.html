<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Track Generator Visualization</title>
  <script src="src/libraries/p5.js"></script>
  <script src="src/libraries/rhill-voronoi-core.js"></script>
  <link rel="stylesheet" type="text/css" href="style.css">
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      margin: 0;
      padding: 20px;
    }
    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
    }
    form {
      display: flex;
      flex-direction: row;
      align-items: center;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    form > label, form > input, form > select, form > button {
      margin-bottom: 10px;
      margin-right: 10px;
    }
    form > button {
      margin-left: auto;
    }
    canvas {
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <main>
    <form id="trackForm">
      <label for="seedInput">Enter Seed:</label>
      <input type="text" id="seedInput" name="seedInput">
      <label for="cellCountInput">Enter Number of Cell Tracks:</label>
      <input type="text" id="cellCountInput" name="cellCountInput">
      <label for="modeSelect">Select Track Generator Mode:</label>
      <select id="modeSelect" name="modeSelect">
        <option value="voronoi">Voronoi</option>
        <option value="convexHull">Convex Hull</option>
      </select>
      <button type="submit">Generate Track</button>
    </form>
  </main>
  <script type="module">
    import { TrackGeneratorFactory } from './src/trackGen/trackGeneratorFactory.js';
    import * as utils from './src/utils/utils.js';

    const BBOX = { xl: 0, xr: 600, yt: 0, yb: 600 };
    let trackGenerator, trackEdges, diagram, splineTrack;

    document.getElementById('trackForm').addEventListener('submit', function(event) {
      event.preventDefault();
      const seed = parseInt(document.getElementById('seedInput').value);
      const trackSize = parseInt(document.getElementById('cellCountInput').value);
      const mode = document.getElementById('modeSelect').value;
      generateTrack(seed, trackSize, mode);
    });

    function generateTrack(seed, trackSize, mode) {
      if (isNaN(seed)) seed = Math.random();
      trackGenerator = TrackGeneratorFactory.createTrackGenerator(mode, BBOX, seed, trackSize);
      trackEdges = trackGenerator.trackEdges;
      splineTrack = utils.splineSmoothing(trackEdges);
      redraw();
    }

    window.setup = function setup() {
      createCanvas(BBOX.xr, BBOX.yb);
      noLoop();
    }

    window.draw = function draw() {
      background(0);
      if (splineTrack) {
        strokeWeight(0.5);
        noFill();
        stroke(0, 255, 0);
        strokeWeight(3);
        drawSpline(splineTrack);
      }
    }

    function drawSpline(spline) {
      beginShape();
      let startColor = color(0, 255, 255);
      let endColor = color(255, 0, 255);
      for (let i = 0; i < spline.length; i++) {
        stroke(lerpColor(startColor, endColor, i / spline.length));
        point(spline[i].x, spline[i].y);
      }
      endShape(CLOSE);
    }

    window.setup = setup;
    window.draw = draw;
  </script>
</body>
</html>
