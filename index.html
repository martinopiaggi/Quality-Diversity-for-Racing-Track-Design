<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voronoi Track Visualization</title>
  <script src="src/libraries/p5.js"></script>
  <script src="src/libraries/p5.sound.min.js"></script>
  <script src="src/libraries/rhill-voronoi-core.js"></script>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <main></main>
  <script type="module">
    import { VoronoiTrackGenerator } from './src/voronoiTrackGenerator.js';
    import * as utils from './src/utils/utils.js';

    // Constants
    const BBOX = { xl: 0, xr: 600, yt: 0, yb: 600 };
    const TRACK_SIZE = 2;

    // Track generation
    const seed = 0.0851364608132732 //Math.random();
    const trackGenerator = new VoronoiTrackGenerator(BBOX, seed, TRACK_SIZE);
    const trackEdges = trackGenerator.trackEdges;
    const diagram = trackGenerator.diagram;
    const splineTrack = utils.splineSmoothing(trackEdges);

    function setup() {
      createCanvas(BBOX.xr, BBOX.yb);
      console.log("SEED: " + seed);
      console.log("trackSize (# cells): " + TRACK_SIZE);
    }

    function draw() {
      background(0);
      strokeWeight(0.5);
      drawVoronoi();
      noFill();
      stroke(0, 255, 0);
      strokeWeight(3);
      drawSpline(splineTrack);
    }

    // Make setup and draw available globally
    window.setup = setup;
    window.draw = draw;

    function drawVoronoi() {
      stroke(255);
      diagram.edges.forEach(edge => line(edge.va.x, edge.va.y, edge.vb.x, edge.vb.y));
    }

    function drawSpline(spline) {
      beginShape();
      let startColor = color(0, 255, 255);
      let endColor = color(255, 0, 255);
      for (let i = 0; i < spline.length; i++) {
        stroke(lerpColor(startColor, endColor, i / spline.length));
        point(spline[i].x, spline[i].y);
      }
      endShape(CLOSE);
    }
  </script>
</body>
</html>
